import{getLocalAuth as c}from"./auth.js";export function request(t,n,{body:e=void 0,headers:r=void 0}={}){return!(e instanceof FormData)&&!(e instanceof File)&&typeof e=="object"&&e!==null&&(e=JSON.stringify(e)),fetch(n,{method:t,headers:Object.assign(u(),r),credentials:"include",body:e}).then(handleResponse)}function u(){const t=c();return t===null?{}:{authorization:"Bearer "+t.token}}export function subscribe(t,n){const e=c();if(e!==null){const a=new URL(t,location.origin);a.searchParams.set("auth_token",e.token),t=a.toString()}const r=a=>{try{const i=JSON.parse(a.data);n(i)}catch(i){}},o=()=>{},s=new EventSource(t,{withCredentials:!0});return s.addEventListener("message",r),s.addEventListener("error",o),()=>{s.removeEventListener("message",r),s.removeEventListener("error",o),s.close()}}export function handleResponse(t){return t.clone().json().catch(()=>t.text()).then(n=>{if(!t.ok){const e=new Error;throw typeof n=="string"&&n.trim()!==""?e.message=n.trim():typeof n=="object"&&n!==null&&typeof n.error=="string"?e.message=n.error:e.message=t.statusText,e.name=e.message.split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(""),e.name.endsWith("Error")||(e.name=e.name+"Error"),e.headers=t.headers,e.statusCode=t.status,e}return{body:n,headers:t.headers,statusCode:t.status}})}
