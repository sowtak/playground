var D=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function _(f,s,l){return l={path:s,exports:{},require:function(d,n){return P(d,n??l.path)}},f(l,l.exports),l.exports}function S(f){return f&&Object.prototype.hasOwnProperty.call(f,"default")&&Object.keys(f).length===1?f.default:f}function P(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var A=_(function(f){var s=Object.prototype.hasOwnProperty,l="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(l=!1));function n(r,o,h){this.fn=r,this.context=o,this.once=h||!1}function e(r,o,h,c,m){if(typeof h!="function")throw new TypeError("The listener must be a function");var p=new n(h,c||r,m),u=l?l+o:o;return r._events[u]?r._events[u].fn?r._events[u]=[r._events[u],p]:r._events[u].push(p):(r._events[u]=p,r._eventsCount++),r}function t(r,o){--r._eventsCount==0?r._events=new d:delete r._events[o]}function i(){this._events=new d,this._eventsCount=0}i.prototype.eventNames=function(){var o=[],h,c;if(this._eventsCount===0)return o;for(c in h=this._events)s.call(h,c)&&o.push(l?c.slice(1):c);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(h)):o},i.prototype.listeners=function(o){var h=l?l+o:o,c=this._events[h];if(!c)return[];if(c.fn)return[c.fn];for(var m=0,p=c.length,u=new Array(p);m<p;m++)u[m]=c[m].fn;return u},i.prototype.listenerCount=function(o){var h=l?l+o:o,c=this._events[h];return c?c.fn?1:c.length:0},i.prototype.emit=function(o,h,c,m,p,u){var y=l?l+o:o;if(!this._events[y])return!1;var a=this._events[y],g=arguments.length,w,v;if(a.fn){switch(a.once&&this.removeListener(o,a.fn,void 0,!0),g){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,h),!0;case 3:return a.fn.call(a.context,h,c),!0;case 4:return a.fn.call(a.context,h,c,m),!0;case 5:return a.fn.call(a.context,h,c,m,p),!0;case 6:return a.fn.call(a.context,h,c,m,p,u),!0}for(v=1,w=new Array(g-1);v<g;v++)w[v-1]=arguments[v];a.fn.apply(a.context,w)}else{var O=a.length,C;for(v=0;v<O;v++)switch(a[v].once&&this.removeListener(o,a[v].fn,void 0,!0),g){case 1:a[v].fn.call(a[v].context);break;case 2:a[v].fn.call(a[v].context,h);break;case 3:a[v].fn.call(a[v].context,h,c);break;case 4:a[v].fn.call(a[v].context,h,c,m);break;default:if(!w)for(C=1,w=new Array(g-1);C<g;C++)w[C-1]=arguments[C];a[v].fn.apply(a[v].context,w)}}return!0},i.prototype.on=function(o,h,c){return e(this,o,h,c,!1)},i.prototype.once=function(o,h,c){return e(this,o,h,c,!0)},i.prototype.removeListener=function(o,h,c,m){var p=l?l+o:o;if(!this._events[p])return this;if(!h)return t(this,p),this;var u=this._events[p];if(u.fn)u.fn===h&&(!m||u.once)&&(!c||u.context===c)&&t(this,p);else{for(var y=0,a=[],g=u.length;y<g;y++)(u[y].fn!==h||m&&!u[y].once||c&&u[y].context!==c)&&a.push(u[y]);a.length?this._events[p]=a.length===1?a[0]:a:t(this,p)}return this},i.prototype.removeAllListeners=function(o){var h;return o?(h=l?l+o:o,this._events[h]&&t(this,h)):(this._events=new d,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=l,i.EventEmitter=i,f.exports=i}),N=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SearchResult=void 0;const l=/\$&/g,d=/\$(\d)/g;class n{constructor(t,i,r){this.data=t,this.term=i,this.strategy=r}getReplacementData(t){let i=this.strategy.replace(this.data);if(i==null)return null;let r="";Array.isArray(i)&&(r=i[1],i=i[0]);const o=this.strategy.match(t);if(o==null||o.index==null)return null;const h=i.replace(l,o[0]).replace(d,(c,m)=>o[parseInt(m)]);return{start:o.index,end:o.index+o[0].length,beforeCursor:h,afterCursor:r}}replace(t,i){const r=this.getReplacementData(t);if(r!==null)return i=r.afterCursor+i,[[t.slice(0,r.start),r.beforeCursor,t.slice(r.end)].join(""),i]}render(){return this.strategy.renderTemplate(this.data,this.term)}getStrategyId(){return this.strategy.getId()}}s.SearchResult=n}),L=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Strategy=s.DEFAULT_INDEX=void 0,s.DEFAULT_INDEX=1;class l{constructor(n){this.props=n,this.cache={}}destroy(){return this.cache={},this}replace(n){return this.props.replace(n)}execute(n,e){var t;const i=this.matchWithContext(n);if(!i)return!1;const r=i[(t=this.props.index)!==null&&t!==void 0?t:s.DEFAULT_INDEX];return this.search(r,o=>{e(o.map(h=>new N.SearchResult(h,r,this)))},i),!0}renderTemplate(n,e){if(this.props.template)return this.props.template(n,e);if(typeof n=="string")return n;throw new Error(`Unexpected render data type: ${typeof n}. Please implement template parameter by yourself`)}getId(){return this.props.id||null}match(n){return typeof this.props.match=="function"?this.props.match(n):n.match(this.props.match)}search(n,e,t){this.props.cache?this.searchWithCach(n,e,t):this.props.search(n,e,t)}matchWithContext(n){const e=this.context(n);return e===!1?null:this.match(e===!0?n:e)}context(n){return this.props.context?this.props.context(n):!0}searchWithCach(n,e,t){this.cache[n]!=null?e(this.cache[n]):this.props.search(n,i=>{this.cache[n]=i,e(i)},t)}}s.Strategy=l}),T=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Completer=void 0;class l extends A.EventEmitter{constructor(n){super();this.handleQueryResult=e=>{this.emit("hit",{searchResults:e})},this.strategies=n.map(e=>new L.Strategy(e))}destroy(){return this.strategies.forEach(n=>n.destroy()),this}run(n){for(const e of this.strategies)if(e.execute(n,this.handleQueryResult))return;this.handleQueryResult([])}}s.Completer=l}),E=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.createCustomEvent=void 0;const l=typeof window!="undefined"&&!!window.CustomEvent,d=(n,e)=>{if(l)return new CustomEvent(n,e);const t=document.createEvent("CustomEvent");return t.initCustomEvent(n,!1,(e==null?void 0:e.cancelable)||!1,(e==null?void 0:e.detail)||void 0),t};s.createCustomEvent=d}),I=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Dropdown=s.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME=s.DEFAULT_DROPDOWN_ITEM_CLASS_NAME=s.DEFAULT_DROPDOWN_CLASS_NAME=s.DEFAULT_DROPDOWN_PLACEMENT=s.DEFAULT_DROPDOWN_MAX_COUNT=void 0,s.DEFAULT_DROPDOWN_MAX_COUNT=10,s.DEFAULT_DROPDOWN_PLACEMENT="auto",s.DEFAULT_DROPDOWN_CLASS_NAME="dropdown-menu textcomplete-dropdown",s.DEFAULT_DROPDOWN_ITEM_CLASS_NAME="textcomplete-item",s.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME=`${s.DEFAULT_DROPDOWN_ITEM_CLASS_NAME} active`;class l extends A.EventEmitter{constructor(e,t){super();this.el=e,this.option=t,this.shown=!1,this.items=[],this.activeIndex=null}static create(e){const t=document.createElement("ul");t.className=e.className||s.DEFAULT_DROPDOWN_CLASS_NAME,Object.assign(t.style,{display:"none",position:"absolute",zIndex:"1000"},e.style);const i=e.parent||document.body;return i==null||i.appendChild(t),new l(t,e)}render(e,t){const i=(0,E.createCustomEvent)("render",{cancelable:!0});return this.emit("render",i),i.defaultPrevented?this:(this.clear(),e.length===0?this.hide():(this.items=e.slice(0,this.option.maxCount||s.DEFAULT_DROPDOWN_MAX_COUNT).map((r,o)=>{var h;return new d(this,o,r,((h=this.option)===null||h===void 0?void 0:h.item)||{})}),this.setStrategyId(e[0]).renderEdge(e,"header").renderItems().renderEdge(e,"footer").show().setOffset(t).activate(0),this.emit("rendered",(0,E.createCustomEvent)("rendered")),this))}destroy(){var e;return this.clear(),(e=this.el.parentNode)===null||e===void 0||e.removeChild(this.el),this}select(e){const t={searchResult:e.searchResult},i=(0,E.createCustomEvent)("select",{cancelable:!0,detail:t});return this.emit("select",i),i.defaultPrevented?this:(this.hide(),this.emit("selected",(0,E.createCustomEvent)("selected",{detail:t})),this)}show(){if(!this.shown){const e=(0,E.createCustomEvent)("show",{cancelable:!0});if(this.emit("show",e),e.defaultPrevented)return this;this.el.style.display="block",this.shown=!0,this.emit("shown",(0,E.createCustomEvent)("shown"))}return this}hide(){if(this.shown){const e=(0,E.createCustomEvent)("hide",{cancelable:!0});if(this.emit("hide",e),e.defaultPrevented)return this;this.el.style.display="none",this.shown=!1,this.clear(),this.emit("hidden",(0,E.createCustomEvent)("hidden"))}return this}clear(){return this.items.forEach(e=>e.destroy()),this.items=[],this.el.innerHTML="",this.activeIndex=null,this}up(e){return this.shown?this.moveActiveItem("prev",e):this}down(e){return this.shown?this.moveActiveItem("next",e):this}moveActiveItem(e,t){if(this.activeIndex!=null){const i=e==="next"?this.getNextActiveIndex():this.getPrevActiveIndex();i!=null&&(this.activate(i),t.preventDefault())}return this}activate(e){return this.activeIndex!==e&&(this.activeIndex!=null&&this.items[this.activeIndex].deactivate(),this.activeIndex=e,this.items[e].activate()),this}isShown(){return this.shown}getActiveItem(){return this.activeIndex!=null?this.items[this.activeIndex]:null}setOffset(e){const t=document.documentElement;if(t){const i=this.el.offsetWidth;if(e.left){const h=this.option.dynamicWidth?t.scrollWidth:t.clientWidth;e.left+i>h&&(e.left=h-i),this.el.style.left=`${e.left}px`}else e.right&&(e.right-i<0&&(e.right=0),this.el.style.right=`${e.right}px`);let r=!1;const o=this.option.placement||s.DEFAULT_DROPDOWN_PLACEMENT;if(o==="auto"){const h=this.items.length*e.lineHeight;r=e.clientTop!=null&&e.clientTop+h>t.clientHeight}o==="top"||r?(this.el.style.bottom=`${t.clientHeight-e.top+e.lineHeight}px`,this.el.style.top="auto"):(this.el.style.top=`${e.top}px`,this.el.style.bottom="auto")}return this}getNextActiveIndex(){if(this.activeIndex==null)throw new Error;return this.activeIndex<this.items.length-1?this.activeIndex+1:this.option.rotate?0:null}getPrevActiveIndex(){if(this.activeIndex==null)throw new Error;return this.activeIndex!==0?this.activeIndex-1:this.option.rotate?this.items.length-1:null}renderItems(){const e=document.createDocumentFragment();for(const t of this.items)e.appendChild(t.el);return this.el.appendChild(e),this}setStrategyId(e){const t=e.getStrategyId();return t&&(this.el.dataset.strategy=t),this}renderEdge(e,t){const i=this.option[t],r=document.createElement("li");return r.className=`textcomplete-${t}`,r.innerHTML=typeof i=="function"?i(e.map(o=>o.data)):i||"",this.el.appendChild(r),this}}s.Dropdown=l;class d{constructor(e,t,i,r){this.dropdown=e,this.index=t,this.searchResult=i,this.props=r,this.active=!1,this.onClick=c=>{c.preventDefault(),this.dropdown.select(this)},this.className=this.props.className||s.DEFAULT_DROPDOWN_ITEM_CLASS_NAME,this.activeClassName=this.props.activeClassName||s.DEFAULT_DROPDOWN_ITEM_ACTIVE_CLASS_NAME;const o=document.createElement("li");o.className=this.active?this.activeClassName:this.className;const h=document.createElement("span");h.tabIndex=-1,h.innerHTML=this.searchResult.render(),o.appendChild(h),o.addEventListener("mousedown",this.onClick),o.addEventListener("touchstart",this.onClick),this.el=o}destroy(){var e;const t=this.el;return(e=t.parentNode)===null||e===void 0||e.removeChild(t),t.removeEventListener("mousedown",this.onClick,!1),t.removeEventListener("touchstart",this.onClick,!1),this}activate(){return this.active||(this.active=!0,this.el.className=this.activeClassName,this.dropdown.el.scrollTop=this.el.offsetTop),this}deactivate(){return this.active&&(this.active=!1,this.el.className=this.className),this}}}),b=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Editor=void 0;class l extends A.EventEmitter{destroy(){return this}applySearchResult(n){throw new Error("Not implemented.")}getCursorOffset(){throw new Error("Not implemented.")}getBeforeCursor(){throw new Error("Not implemented.")}emitMoveEvent(n){const e=(0,E.createCustomEvent)("move",{cancelable:!0,detail:{code:n}});return this.emit("move",e),e}emitEnterEvent(){const n=(0,E.createCustomEvent)("enter",{cancelable:!0});return this.emit("enter",n),n}emitChangeEvent(){const n=(0,E.createCustomEvent)("change",{detail:{beforeCursor:this.getBeforeCursor()}});return this.emit("change",n),n}emitEscEvent(){const n=(0,E.createCustomEvent)("esc",{cancelable:!0});return this.emit("esc",n),n}getCode(n){return n.keyCode===9||n.keyCode===13?"ENTER":n.keyCode===27?"ESC":n.keyCode===38?"UP":n.keyCode===40||n.keyCode===78&&n.ctrlKey?"DOWN":n.keyCode===80&&n.ctrlKey?"UP":"OTHER"}}s.Editor=l}),x=_(function(f,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Textcomplete=void 0;const l=["show","shown","render","rendered","selected","hidden","hide"];class d extends A.EventEmitter{constructor(e,t,i){super();this.editor=e,this.isQueryInFlight=!1,this.nextPendingQuery=null,this.handleHit=({searchResults:r})=>{r.length?this.dropdown.render(r,this.editor.getCursorOffset()):this.dropdown.hide(),this.isQueryInFlight=!1,this.nextPendingQuery!==null&&this.trigger(this.nextPendingQuery)},this.handleMove=r=>{r.detail.code==="UP"?this.dropdown.up(r):this.dropdown.down(r)},this.handleEnter=r=>{const o=this.dropdown.getActiveItem();o?(this.dropdown.select(o),r.preventDefault()):this.dropdown.hide()},this.handleEsc=r=>{this.dropdown.isShown()&&(this.dropdown.hide(),r.preventDefault())},this.handleChange=r=>{r.detail.beforeCursor!=null?this.trigger(r.detail.beforeCursor):this.dropdown.hide()},this.handleSelect=r=>{this.emit("select",r),r.defaultPrevented||this.editor.applySearchResult(r.detail.searchResult)},this.handleResize=()=>{this.dropdown.isShown()&&this.dropdown.setOffset(this.editor.getCursorOffset())},this.completer=new T.Completer(t),this.dropdown=I.Dropdown.create((i==null?void 0:i.dropdown)||{}),this.startListening()}destroy(e=!0){return this.completer.destroy(),this.dropdown.destroy(),e&&this.editor.destroy(),this.stopListening(),this}isShown(){return this.dropdown.isShown()}hide(){return this.dropdown.hide(),this}trigger(e){return this.isQueryInFlight?this.nextPendingQuery=e:(this.isQueryInFlight=!0,this.nextPendingQuery=null,this.completer.run(e)),this}startListening(){var e;this.editor.on("move",this.handleMove).on("enter",this.handleEnter).on("esc",this.handleEsc).on("change",this.handleChange),this.dropdown.on("select",this.handleSelect);for(const t of l)this.dropdown.on(t,i=>this.emit(t,i));this.completer.on("hit",this.handleHit),(e=this.dropdown.el.ownerDocument.defaultView)===null||e===void 0||e.addEventListener("resize",this.handleResize)}stopListening(){var e;(e=this.dropdown.el.ownerDocument.defaultView)===null||e===void 0||e.removeEventListener("resize",this.handleResize),this.completer.removeAllListeners(),this.dropdown.removeAllListeners(),this.editor.removeListener("move",this.handleMove).removeListener("enter",this.handleEnter).removeListener("esc",this.handleEsc).removeListener("change",this.handleChange)}}s.Textcomplete=d}),M=_(function(f,s){var l=D&&D.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t),Object.defineProperty(n,i,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),d=D&&D.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&l(e,n,t)};Object.defineProperty(s,"__esModule",{value:!0}),d(T,s),d(I,s),d(b,s),d(N,s),d(L,s),d(x,s),d(E,s)});export{D as a,_ as c,M as d,S as g};
